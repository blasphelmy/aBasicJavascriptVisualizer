<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
    ></script>

    <script src="lib/codemirror.js"></script>
    <script src="javascript/matchbrackets.js"></script>
    <script src="javascript/closebrackets.js"></script>
    <link rel="stylesheet" href="lib/codemirror.css">
    <link rel="stylesheet" href="theme/material-palenight.css">
    <script src="javascript/javascript.js"></script>

    <script src="objects.js"></script>
    <script src="tools.js"></script>
    <script src="regexDefinitions.js"></script>
    <script src="handlers.js"></script>
    <script src="eventListeners.js"></script>
    <link rel="stylesheet" href="style.css" />

    <title>parse</title>
  </head>
  <body>
<style>
</style>
<h1>David Nguyen</h1>
<div id="console">
</div>
<div id="codeEditorWrapper">
<div class="codeEditiors">
  <textarea id="code" name="code">
    var year = 2;
    var hellomessage = "Hello! Welcome to my landing page!";
    function moreInfo(){
      hellomessage = "More information could be found on my about me page!";
      console.log(" ");
      console.log(goal);
    }
    function a(){
      hellomessage = "Iâ€™m a " + year + "nd  year CSI student at ";
      var location;
      function b(){
        location = "Renton Technical College.";
        goal = "What I'm looking for are CompSci internship opportunities.";
      }
      b();
      console.log(hellomessage + location);
      moreInfo();
    }
    function offer(){
        var haveOffer = "If you have any opportunities";
      console.log(haveOffer + "  and would like to offer me an internship...");
    }
    function contactMe(){
      var email = "dhnguyen08@student.rtc.edu";
      console.log("Or, you could shoot me an email @ \n" + email);
      function a(){
        console.log(" ");
        console.log("Thanks for stopping by!");
      }
      a();
    }
    console.log(hellomessage);
    a();
    offer();
    console.log(hellomessage);
    contactMe();    
  </textarea>
</div>
<div class="codeEditiors">
  <textarea id="code_array" name="code">
  </textarea>
</div>
</div>
<button id="runBtn" onclick="initParse()">Run Code</button>
</div>
<div id="mainFrameContainer">
</div>

</body>

<script>
var errorDetected = false;
var editor = null;
var outPutEditor = null;
var count = 1;
function initParse() {
  //console.clear();
  document.getElementById("mainFrameContainer").innerHTML = "";
  document.getElementById("console").innerHTML = "";
  errorDetected = false;
  count = 1;
  //step 1, we get javascript code from user as a raw string.
  var inputString = editor.getValue() + ";";
  //now we split the inputString into its induvidual components
  var CallStack = breakIntoComponents(inputString);
  outPutCallStacktoCodeEditor(CallStack);
  var newFunction = new functionDEF("Global", 0, CallStack.length);
  var FinalFrame = interpretCallStack(0, CallStack, new frame(newFunction, CallStack.length, count));
  console.log(FinalFrame);
}
function interpretCallStack(start, array, Frame) {
  var elementFrame = null;
  if(Frame.id === "Global"){
    elementFrame = document.querySelector("#mainFrameContainer");
  }else{
    elementFrame = document.getElementById(Frame.previousNodeFrame.id + Frame.previousNodeFrame.fIndex + "ChildrenFrames");
    elementFrame.classList.remove("hide");
    elementFrame.classList.add("show");
  }
  
  createNewFrameElements(elementFrame, Frame);
  
  for (var index = Frame.start; index <= Frame.end && errorDetected === false; index++) {
   console.log("index ", index);
    //DETECT FUNCTION DECLATION TOKEN
    if (isFunctionDeclarion(array[index])) {
     index = functionDeclaredHandler(index, array, Frame);
      //DETECT VARIABLE DECLATION TOKEN
    } else if (isVarDeclartion(array[index])) {
      index = variableDeclarationHandler(index, array, Frame);
      //DETECT VARIABLE REASSIGNMENT
    }else if(detectStatementVariableReassignment(array[index])){
      variableReassignmentHandler(index, array, Frame);
    }
    else if(detectConsoleLog(array[index])){
        consoleLoghandler(index, array, Frame);
    }
    else if(detectFunctionCalls(array[index])){
      var originFrame = returnFrameContainingFunctionDEF(Frame, array[index]);
      if(originFrame.returnFunctionDefinitions(array[index])){
        var newFunctionDef = originFrame.returnFunctionDefinitions(array[index]);
        var newFrame = new frame(newFunctionDef, index, count);
        count++;
        newFrame.previousNodeFrame = originFrame;
        originFrame.addChildFrame(newFrame);
        interpretCallStack(newFunctionDef.getStart, array, newFrame);
      }
      else{
        addConsoleLine("error: on line " + index + " function definition doesn't exist!");
        errorDetected = true;
        return;
      }
    }else if(!(new RegExp(/(['}{'])/gm).test(array[index])) && index < array.length-1){
      addConsoleLine("error: on line " + index);
      errorDetected = true;
      return;
    }
  }
  if(Frame.id === "Global"){
    return Frame;
  }
}
function returnFunction(array) {}
  </script>
</html>
