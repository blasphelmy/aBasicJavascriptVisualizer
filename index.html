<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
    ></script>

    <script src="lib/codemirror.js"></script>
    <link rel="stylesheet" href="lib/codemirror.css">
    <link rel="stylesheet" href="theme/material-palenight.css">
    <script src="javascript/javascript.js"></script>

    <script src="objects.js"></script>
    <script src="tools.js"></script>
    <script src="regexDefinitions.js"></script>
    <script src="handlers.js"></script>
    <script src="eventListeners.js"></script>
    <link rel="stylesheet" href="style.css" />

    <title>parse</title>
  </head>
  <body>
<style>
  .codeEditiors{
    width: 46%;
    display: inline-block;
    border-width: 2px;

  }
</style>
<div class="codeEditiors">
<textarea id="code" name="code">
  var a = 10;
  function b(){
    a = 5;  
    c();
    console.log(d);
  }
  function c(){
    d = 6;
    var a = 7;
    e = 9;
    function f(){
      a = 2;
    }
    f();
  }
  b();
</textarea>
</div>
<div class="codeEditiors">
<textarea id="code_array" name="code" style="position:relative; width: 50%;">
</textarea>
</div>
<div id="mainFrameContainer">
  <!-- <div class="frameContainer">
    <p id="frameName">Scope Name: Gobal</p>
    <p id="parentsName">Parent's Name: Null</p>
      <div id="variablesMap" class="frameContainer">
        <p>variables : </p>
        <p>a = 10</p>
        <p> name = "David"</p>
      </div>
      <div id="functionDefinitions" class="frameContainer">
        <p>Function Definitions : </p>
        <p>a() start: 1 end: 5</p>
      </div>
      <div id="childrenFrames" class="frameContainer">
        <p>Children Frames : </p>
      </div>
  </div> -->
</div>
<button id="runBtn" onclick="initParse()">Run Code</button>
</div>

</body>

  <script>
var editor = null;
var outPutEditor = null;
var count = 0;
function initParse() {
  //console.clear();
  document.getElementById("mainFrameContainer").innerHTML = "";
  //step 1, we get javascript code from user as a raw string.
  var inputString = editor.getValue() + ";";
  //now we split the inputString into its induvidual components
  var CallStack = breakIntoComponents(inputString);
  outPutCallStacktoCodeEditor(CallStack);
  var newFunction = new functionDEF("Global", 0, CallStack.length);
  var FinalFrame = interpretCallStack(0, CallStack, new frame(newFunction, CallStack.length, count));
  console.log(FinalFrame);
}
function interpretCallStack(start, array, Frame) {
  var element = null;
  if(Frame.id === "Global"){
    element = document.querySelector("#mainFrameContainer");
  }else{
    element = document.getElementById(Frame.previousNodeFrame.id + Frame.previousNodeFrame.fIndex);
  }

  var newScopeFrame = document.createElement("div");
  newScopeFrame.id = Frame.id + Frame.fIndex;
  newScopeFrame.classList.add("frameContainer");
  newScopeFrame.innerHTML = "<p>Frame ID : " + Frame.id + "</p>";

  var newVariableFrames = document.createElement("div");
  newVariableFrames.id = Frame.id + count + "variables";
  newVariableFrames.classList.add("frameContainer");

  newScopeFrame.appendChild(newVariableFrames);
  element.appendChild(newScopeFrame);

  for (var index = Frame.start; index <= Frame.end; index++) {
    
   console.log("index ", index);
    //DETECT FUNCTION DECLATION TOKEN
   if (isFunctionDeclarion(array[index])) {
      index = functionDeclaredHandler(index, array, Frame);
      //DETECT VARIABLE DECLATION TOKEN
    } else if (isVarDeclartion(array[index])) {
      index = variableDeclarationHandler(index, array, Frame);
      //DETECT VARIABLE REASSIGNMENT
    }else if(detectStatementVariableReassignment(array[index])){
      // console.log("variable reassigbment on line ", index);
      // console.log(array[index]);
      var tempArray = array[index].split("=");
      var variableName = tempArray[0].trim();
      var expression = tempArray[1].split(";");
      expression = expression[0];
      var newFrame = returnFrameContainingVariable(Frame, variableName);
      newFrame.variables.set(variableName, eval(expression));
      //console.log(newFrame.id);
    }
    else if(detectFunctionCalls(array[index])){
      var originFrame = returnFrameContainingFunctionDEF(Frame, array[index]);
      if(originFrame.returnFunctionDefinitions(array[index])){
        var newFunctionDef = originFrame.returnFunctionDefinitions(array[index]);
        var newFrame = new frame(newFunctionDef, index, count);
        count++;
        newFrame.previousNodeFrame = originFrame;
        originFrame.addChildFrame(newFrame);
        interpretCallStack(newFunctionDef.getStart, array, newFrame);
      }else{
        return "on line " + index + " error: function definition doesn't exist!";
      }
    }
  }
  if(Frame.id === "Global"){
    return Frame;
  }
}
function assignExpressionObjects(newComponentsArray){

}
function returnFunction(array) {}
  </script>
</html>
