<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
    ></script>

    <script src="lib/codemirror.js"></script>
    <link rel="stylesheet" href="lib/codemirror.css">
    <link rel="stylesheet" href="theme/material-palenight.css">
    <script src="javascript/javascript.js"></script>

    <script src="objects.js"></script>
    <script src="tools.js"></script>
    <script src="regexDefinitions.js"></script>
    <script src="handlers.js"></script>
    <script src="eventListeners.js"></script>
    <link rel="stylesheet" href="style.css" />

    <title>parse</title>
  </head>
  <body>
<style>
.frameContainer { 
  margin: 20px;
  margin-left: 30px;
  padding: 10px;
  background-color: rgba(214, 120, 223, 0.042);
  border-left-color: rgba(215, 120, 223, 0.116);
  border-left-width: 2px;
  border-left-style: solid;
  border-radius: 7px;
  color: rgb(255, 253, 223);
  -webkit-box-shadow: 0px 0px 15px 4px rgba(0, 0, 0, 0.15); 
box-shadow: 0px 0px 15px 4px rgba(0, 0, 0, 0.15);
}
.variableColors{
  background-color: rgba(17, 253, 9, 0.096);
  border-left-color: rgba(17, 253, 9, 0.144);
}
.functDEF {
  background-color: rgba(79, 255, 255, 0.082);
  border-left-color: rgba(79, 255, 255, 0.137);
}
.activeFrames{
  background-color: rgba(253, 58, 9, 0.062);
  border-left-color: rgba(253, 58, 9, 0.116);
}
</style>
<h1>A Simple Javascript Parser</h1>
<div id="codeEditorWrapper">
<div class="codeEditiors">
  <textarea id="code" name="code">
var varca = 10;function b(){a = 5;  functionC();console.log(d);}
function functionC()
{d = 6;var a = 7;e = 9;function f(){a = 2;}f();}b();    
  </textarea>
</div>
<div class="codeEditiors">
  <textarea id="code_array" name="code">
  </textarea>
</div>
</div>
<button id="runBtn" onclick="initParse()">Run Code</button>
</div>
<div id="mainFrameContainer">
</div>

</body>

  <script>
var editor = null;
var outPutEditor = null;
var count = 1;
function initParse() {
  //console.clear();
  document.getElementById("mainFrameContainer").innerHTML = "";
  count = 1;
  //step 1, we get javascript code from user as a raw string.
  var inputString = editor.getValue() + ";";
  //now we split the inputString into its induvidual components
  var CallStack = breakIntoComponents(inputString);
  outPutCallStacktoCodeEditor(CallStack);
  var newFunction = new functionDEF("Global", 0, CallStack.length);
  var FinalFrame = interpretCallStack(0, CallStack, new frame(newFunction, CallStack.length, count));
  console.log(FinalFrame);
}
function interpretCallStack(start, array, Frame) {
  var element = null;
  if(Frame.id === "Global"){
    element = document.querySelector("#mainFrameContainer");
  }else{
    element = document.getElementById(Frame.previousNodeFrame.id + Frame.previousNodeFrame.fIndex + "ChildrenFrames");
  }

  var newScopeFrame = document.createElement("div");
  newScopeFrame.id = Frame.id + Frame.fIndex;
  newScopeFrame.classList.add("frameContainer", "scopeColors");
  newScopeFrame.innerHTML = "<p>Scope ID : " + Frame.id + "</p>";

  var newVariableFrames = document.createElement("div");
  newVariableFrames.id = Frame.id + Frame.fIndex + "variables";
  newVariableFrames.classList.add("frameContainer", "variableColors");
  newVariableFrames.innerHTML = "<p>Active Variables : </p>";

  var newFunctionDefContainer = document.createElement("div");
  newFunctionDefContainer.id = Frame.id + Frame.fIndex + "FunctionDef";
  newFunctionDefContainer.classList.add("frameContainer", "functDEF");
  newFunctionDefContainer.innerHTML = "<p>Function Definitions : </p>";

  var newFramesContainer = document.createElement("div");
  newFramesContainer.id = Frame.id + Frame.fIndex + "ChildrenFrames";
  newFramesContainer.classList.add("frameContainer",  "activeFrames");
  newFramesContainer.innerHTML = "<p>Active Frames : </p>";

  newScopeFrame.appendChild(newVariableFrames);
  newScopeFrame.appendChild(newFunctionDefContainer);
  newScopeFrame.appendChild(newFramesContainer);
  element.appendChild(newScopeFrame);

  for (var index = Frame.start; index <= Frame.end; index++) {
    
   console.log("index ", index);
    //DETECT FUNCTION DECLATION TOKEN
   if (isFunctionDeclarion(array[index])) {
     index = functionDeclaredHandler(index, array, Frame);
      //DETECT VARIABLE DECLATION TOKEN
    } else if (isVarDeclartion(array[index])) {

      try{
        var temp = array[index+1].split("=");
        console.log("eval = ", eval(temp[1]));
     }catch{
       return "error on index :" + index;
     }

      index = variableDeclarationHandler(index, array, Frame);
      //DETECT VARIABLE REASSIGNMENT
    }else if(detectStatementVariableReassignment(array[index])){
      // console.log("variable reassigbment on line ", index);
      // console.log(array[index]);
      var tempArray = array[index].split("=");
      var variableName = tempArray[0].trim();
      var expression = tempArray[1].split(";");
      expression = expression[0];
      var newFrame = returnFrameContainingVariable(Frame, variableName);
      newFrame.variables.set(variableName, eval(expression));
      //console.log(newFrame.id);
    }
    else if(detectFunctionCalls(array[index])){
      var originFrame = returnFrameContainingFunctionDEF(Frame, array[index]);
      if(originFrame.returnFunctionDefinitions(array[index])){
        var newFunctionDef = originFrame.returnFunctionDefinitions(array[index]);
        var newFrame = new frame(newFunctionDef, index, count);
        count++;
        newFrame.previousNodeFrame = originFrame;
        originFrame.addChildFrame(newFrame);
        interpretCallStack(newFunctionDef.getStart, array, newFrame);
      }else if(array){
        return "on line " + index + " error: function definition doesn't exist!";
      }
    }
  }
  if(Frame.id === "Global"){
    return Frame;
  }
}
function assignExpressionObjects(newComponentsArray){

}
function returnFunction(array) {}
  </script>
</html>
